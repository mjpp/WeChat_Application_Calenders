<!-- INITIAL BUTTON -->
<!-- get the information of users after users click the button  -->
<button class="button-area-bt-enter" wx:if="{{!hasUserInfo && canIUse}}" open-type="getUserInfo" bindgetuserinfo="getUserInfo"> 進入小程序 </button>


<!-- CALENDER -->
<view class="page" wx:if="{{hasUserInfo}}">

  <!-- SHOW RECEIVE TASK -->
  <scroll-view scroll-y="true" style="height: 70%;" class="drawer_box" wx:if="{{showReceiveTask}}">
    <view class="drawer_content">
      <view class="empty-block-receive"></view>
      <view class="top grid">
        <label class="title col-0">标题</label>
        <view class=" input_h30 col-1 show">{{receiveTask.taskName || "no title"}}</view>
      </view>
      <view class="top grid">
        <label class="title col-0">內容</label>
        <view class=" input_h30 col-1 show">{{receiveTask.content || "no content"}}</view>
      </view>
      <view class="top grid">
        <label class="title col-0">日期</label>
        <view class=" input_h30 col-1 show">
          <text wx:for="{{receiveTask.selectedDays}}" wx:for-index='key' wx:key="{{key}}">
          <text>{{receiveTask.selectedDays[key].year}}/{{receiveTask.selectedDays[key].month}}/{{receiveTask.selectedDays[key].day}} </text>
          </text>
        </view>
      </view>
      <view class="top grid" wx:if="{{showCompleteWarning}}">
        <label class="title col-0">注意</label>
        <view class=" input_h30 col-1 show">{{receiveTask.taskName}}已被完成</view>
      </view>
      <view class="top grid" wx:if="{{showCompleteWarning}}">
        <label class="title col-0"></label>
        <view class=" input_h30 col-1 show">如果接收该消息，{{receiveTask.taskName}}将被消除</view>
      </view>
      <view class="top grid" wx:if="{{showProcessingWarning}}">
        <label class="title col-0">注意</label>
        <view class=" input_h30 col-1 show">{{receiveTask.userName}}向你分享了{{receiveTask.taskName}}</view>
      </view>
      <view class="top grid" wx:if="{{showProcessingWarning}}">
        <label class="title col-0"></label>
        <view class="input_h30 col-1 show">如果接收该消息，{{receiveTask.taskName}}</view>
      </view>
      <view class="top grid" wx:if="{{showProcessingWarning}}">
        <label class="title col-0"></label>
        <view class="input_h30 col-1 show">将被加入日程</view>
      </view>
    </view>
    <view class="empty-block-receive"></view>
    <view class="button-area">
      <button class="button-area-bt agree" bindtap="acceptReceiveTask">接受</button>
      <button class="button-area-bt deny" bindtap="rejectReceiveTask">拒絕</button>
    </view>
  </scroll-view>

  <!-- TASK-LIST FOR CERTAIN DATE -->
  <scroll-view scroll-y="true" style="height: 70%;" class="drawer_box" wx:if="{{showModalStatus}}">
    <view wx:for="{{tempTaskID}}" wx:for-index='key' wx:key="{{key}}">
      <view class="drawer_content">
        <view class="empty-block"></view>
        <form bindsubmit="formSubmit" bindreset="formReset">
          <view class="top grid">
            <label class="title col-0">用戶名</label>
            <view class="input_h30 col-1 show" name="tempUserName" value="{{tempUserName[key]}}">{{tempUserName[key]}}</view>
          </view>
          <view class="top grid">
            <label class="title col-0">标题</label>
            <input class="input_base input_h30 col-1" name="tempTaskName" value="{{tempTaskName[key]}}">{{tempTaskName[key] || "no title"}}</input>
          </view>
          <view class="top grid">
            <label class="title col-0">內容</label>
            <input class="input_base input_h30 col-1" name="tempTaskContent" value="{{tempTaskContent[key]}}">{{tempTaskContent[key] || "no content"}}</input>
          </view>
          <view class="top grid">
            <label class="title col-0">日期</label>
            <view class="input_h30 col-1 show" name="tempSelectedDays">{{tempSelectedDays[key]}}</view>
          </view>
          <view class="empty-block"></view>
          <view class="button-area">
            <button class="button-area-bt" open-type="share" id="{{key}}">分享</button>
            <button class="button-area-bt" formType="submit" id="{{key}}" data-submittype='save'>保存修改</button>
            <button class="button-area-bt" open-type="share" bindtap="setTaskComplete" data-sharetype='complete' id="{{key}}">完成并分享</button>
            <button class="button-area-bt" id="{{key}}" bindtap="setTaskComplete" value="{{tempTaskID[key]}}">完成</button>

            <button class="button-area-bt-close" bindtap="closeTask">關閉</button>
          </view>
        </form>
      </view>
    </view>
  </scroll-view>

  <view class="box">

    <!-- TOP-ROW BUTTONS -->
    <!-- <view class="box-flex">
      <view class="flex-item">
        <button class="item-content"> </button>
      </view>
      <view class="flex-item">
         <button type="warn" bindtap="getTasksInfo">getTasksInfo</button> 
      </view>
      <view class="flex-item">
        <button type="primary" bindtap="closeAddingTask" wx:if="{{isFormOpen}}"> Close task </button>
        <button type="primary" bindtap="startAddingTask" wx:else> Add task </button>
      </view>
    </view> -->

    <!-- CHANGE-MONTH & CURRENT-DATE -->
    <view class="box-flex">
      <view class="flex-item">
        <view class="item-content" bindtap="doDay" data-key='left'>
          <view class="left-key glyphicon glyphicon-triangle-left"></view>
        </view>
      </view>
      <view class="flex-item item-content-current-day">
        <view class="currentDate">{{currentDate}}</view>
      </view>
      <view class="flex-item">
        <view class="item-content" bindtap="doDay" data-key="right">
          <view class="right-key glyphicon glyphicon-triangle-right"></view>
        </view>
      </view>
    </view>

    <!-- WEEKDAY -->
    <view class="box-flex">
      <view class="flex-item">
        <view class="item-content">
          <view class="weekday">一</view>
        </view>
      </view>
      <view class="flex-item">
        <view class="item-content">
          <view class="weekday">二</view>
        </view>
      </view>
      <view class="flex-item">
        <view class="item-content">
          <view class="weekday">三</view>
        </view>
      </view>
      <view class="flex-item">
        <view class="item-content">
          <view class="weekday">四</view>
        </view>
      </view>
      <view class="flex-item">
        <view class="item-content">
          <view class="weekday">五</view>
        </view>
      </view>
      <view class="flex-item">
        <view class="item-content">
          <view class="weekday">六</view>
        </view>
      </view>
      <view class="flex-item">
        <view class="item-content">
          <view class="weekday">日</view>
        </view>
      </view>
    </view>

    <!-- DAYS -->
    <view class="box-flex">
      <view class="flex-item" wx:for="{{currentDayList}}" wx:for-index='key' wx:for-item="vo" wx:key="{{key}}" id="{{key}}" bindtap="onClick">
        <view class="item-content" wx:if="{{(currentDay != vo || !isCurrentMonth) && !currentDayStates[key] && !currentDayHaveTaskStates[key] && currentDayList[key]!=''}}">{{vo}}</view>
        <view class="item-content not-this-month" wx:if="{{(currentDay != vo || !isCurrentMonth) && !currentDayStates[key] && !currentDayHaveTaskStates[key] && currentDayList[key]==''}}">x</view>
        <view class="item-content bk-color-day" wx:if="{{currentDay==vo && isCurrentMonth && !currentDayStates[key] && !currentDayHaveTaskStates[key]}}">{{vo}}</view>
        <view class="item-content select-color-day" wx:if="{{currentDayStates[key] && !currentDayHaveTaskStates[key]}}">{{vo}}</view>
        <view class="item-content have-task" wx:if="{{currentDayHaveTaskStates[key]}}">{{vo}}</view>

      </view>
    </view>

    <view>
      <button class="add-button" bindtap="closeAddingTask" wx:if="{{isFormOpen}}">
        <image class="add-button-img" src="./image/add-task.jpg" mode="aspectFit" />
      </button>
      <button class="add-button" bindtap="startAddingTask" wx:else>
        <image class="add-button-img" src="./image/add-task.jpg" mode="aspectFit" />
      </button>
    </view>


    <!-- ADD-TASK FORM -->
    <form bindsubmit="formSubmit" bindreset="formReset" wx:if="{{isFormOpen}}">
      <view class="task">
        <image class="task-img" src="./image/task-1.jpg" mode="aspectFit" />
      </view>
      <view class="task-content" wx:for="{{selectedDays}}" wx:for-index='key' wx:for-item="item" wx:key="{{key}}" id="{{key}}">
        <text class="task-content-day" wx:if="{{item != null}}">{{item}}
        </text>
      </view>
      <view class="task">
        <image class="task-img" src="./image/task-2.jpg" mode="aspectFit" />
      </view>
      <view class="task-content">
        <input name="input" placeholder="输入任务标题" />
      </view>
      <view class="task">
        <image class="task-img" src="./image/task-3.jpg" mode="aspectFit" />
      </view>
      <view class="task-content">
        <textarea name="textarea" placeholder="一只船孤独地航行在大海上" />
      </view>
      <!-- <view class="task">
        <image class="task-img" src="./image/task-4.jpg" mode="aspectFit" />
      </view>
      <view class="task-content-slider">
        <slider name="slider" show-value block-size="20"></slider>
      </view> -->


      <view class="save">
        <button class="save-button reset" formType="reset">重置</button>
        <button class="save-button keep" formType="submit">保存</button>
        <button class="save-button cancel" bindtap="closeAddingTask">取消</button>
        <!-- <image class="save-img" src="./image/add-task-save.jpg" /> -->
      </view>
    </form>
  </view>
</view>
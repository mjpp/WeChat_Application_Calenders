<!-- INITIAL BUTTON -->
<!-- get the information of users after users click the button  -->
<button wx:if="{{!hasUserInfo && canIUse}}" open-type="getUserInfo" bindgetuserinfo="getUserInfo"> 進入小程序 </button>


<!-- CALENDER -->
<view class="page" wx:if="{{hasUserInfo}}">

  <!-- SHOW RECEIVE TASK -->
  <scroll-view scroll-y="true" style="height: 50%;" class="drawer_box" wx:if="{{showReceiveTask}}">
    <view class="drawer_content">
      <view class="top grid">
        <label class="title col-0">标题</label>
        <view class="input_base input_h30 col-1" name="rName">{{receiveTask.taskName || "no title"}}</view>
      </view>
      <view class="top grid">
        <label class="title col-0">內容</label>
        <view class="input_base input_h30 col-1" name="mobile" value="110">{{receiveTask.content || "no content"}}</view>
      </view>
      <view class="top grid">
        <label class="title col-0">日期</label>
        <view class="input_base input_h30 col-1" name="Email" value="仅供学习使用">
          <text wx:for="{{receiveTask.selectedDays}}" wx:for-index='key' wx:key="{{key}}">
          <text>{{receiveTask.selectedDays[key].year}}/{{receiveTask.selectedDays[key].month}}/{{receiveTask.selectedDays[key].day}} </text>
          </text>
        </view>
      </view>
      <view class="top grid" wx:if="{{showCompleteWarning}}">
        <label class="title col-0">注意</label>
        <view class="input_base input_h30 col-1" name="rName">{{receiveTask.taskName}}已被完成，如果接收该消息，{{receiveTask.taskName}}将被消除</view>
      </view>
      <view class="top grid" wx:if="{{showProcessingWarning}}">
        <label class="title col-0">注意</label>
        <view class="input_base input_h30 col-1" name="rName">{{receiveTask.userName}}向你分享了{{receiveTask.taskName}}，如果接收该消息，{{receiveTask.taskName}}将被加入日程</view>
      </view>
    </view>
    <button type="default" bindtap="acceptReceiveTask">接受</button>
    <button type="warn" bindtap="rejectReceiveTask">拒絕</button>
  </scroll-view>

  <!-- TASK-LIST FOR CERTAIN DATE -->
  <scroll-view scroll-y="true" style="height: 50%;" class="drawer_box" wx:if="{{showModalStatus}}">
    <view wx:for="{{tempTaskID}}" wx:for-index='key' wx:key="{{key}}">
      <view class="drawer_title">{{tempTaskID[key]}}</view>
      <view class="drawer_content">
        <form bindsubmit="formSubmit" bindreset="formReset">
          <view class="top grid">
            <label class="title col-0">用戶名</label>
            <view class="input_base input_h30 col-1" name="tempUserName" value="{{tempUserName[key]}}">{{tempUserName[key]}}</view>
          </view>
          <view class="top grid">
            <label class="title col-0">标题</label>
            <input class="input_base input_h30 col-1" name="tempTaskName" value="{{tempTaskName[key]}}">{{tempTaskName[key] || "no title"}}</input>
          </view>
          <view class="top grid">
            <label class="title col-0">內容</label>
            <input class="input_base input_h30 col-1" name="tempTaskContent" value="{{tempTaskContent[key]}}">{{tempTaskContent[key] || "no content"}}</input>
          </view>
          <view class="top grid">
            <label class="title col-0">日期</label>
            <view class="input_base input_h30 col-1" name="tempSelectedDays">{{tempSelectedDays[key]}}</view>
          </view>
          <button type="primary" formType="submit" id="{{key}}" data-submittype='save'>保存</button>
        </form>
      </view>
      <button type="primary" open-type="share" id="{{key}}">與其他用戶分享此任務</button>
      <button type="warn" open-type="share" bindtap="setTaskComplete" data-sharetype='complete' id="{{key}}">將此任務設置成已完成并分享</button>
      <button type="warn" bindtap="setTaskComplete" value="{{tempTaskID[key]}}">將此任務設置成已完成</button>
    </view>
    <button type="default" bindtap="closeTask">關閉</button>
  </scroll-view>

  <view class="box">

    <!-- TOP-ROW BUTTONS -->
    <view class="box-flex">
      <view class="flex-item">
        <view class="item-content transparent"></view>
      </view>
      <!-- DEBUG BUTTON -->
      <!-- it shows the tasks stored in the local repository -->
      <view class="flex-item">
        <view class="item-content transparent"></view>
        <!-- <button type="warn" bindtap="getTasksInfo">getTasksInfo</button> -->
      </view>
      <view class="flex-item">
        <button type="primary" bindtap="closeAddingTask" wx:if="{{isFormOpen}}"> Close task </button>
        <button type="primary" bindtap="startAddingTask" wx:else> Add task </button>
      </view>
    </view>

    <!-- CHANGE-MONTH & CURRENT-DATE -->
    <view class="box-flex">
      <view class="flex-item">
        <view class="item-content" bindtap="doDay" data-key='left'>
          <view class="glyphicon glyphicon-triangle-left"></view>
        </view>
      </view>
      <view class="flex-item item-content-current-day">
        <view class="item-content">{{currentDate}}</view>
      </view>
      <view class="flex-item">
        <view class="item-content" bindtap="doDay" data-key="right">
          <view class="glyphicon glyphicon-triangle-right"></view>
        </view>
      </view>
    </view>

    <!-- WEEKDAY -->
    <view class="box-flex">
      <view class="flex-item">
        <view class="item-content">一</view>
      </view>
      <view class="flex-item">
        <view class="item-content">二</view>
      </view>
      <view class="flex-item">
        <view class="item-content">三</view>
      </view>
      <view class="flex-item">
        <view class="item-content">四</view>
      </view>
      <view class="flex-item">
        <view class="item-content">五</view>
      </view>
      <view class="flex-item">
        <view class="item-content">六</view>
      </view>
      <view class="flex-item">
        <view class="item-content">日</view>
      </view>
    </view>

    <!-- DAYS -->
    <view class="box-flex">
      <view class="flex-item" wx:for="{{currentDayList}}" wx:for-index='key' wx:for-item="vo" wx:key="{{key}}" id="{{key}}" bindtap="onClick">
        <view class="item-content" wx:if="{{(currentDay != vo || !isCurrentMonth) && !currentDayStates[key] && !currentDayHaveTaskStates[key] }}">{{vo}}</view>
        <view class="item-content bk-color-day" wx:if="{{currentDay==vo && isCurrentMonth && !currentDayStates[key] && !currentDayHaveTaskStates[key]}}">{{vo}}</view>
        <view class="item-content select-color-day" wx:if="{{currentDayStates[key] && !currentDayHaveTaskStates[key]}}">{{vo}}</view>
        <view class="item-content have-task" wx:if="{{currentDayHaveTaskStates[key] }}">{{vo}}</view>
      </view>
    </view>

    <!-- ADD-TASK FORM -->
    <form bindsubmit="formSubmit" bindreset="formReset" wx:if="{{isFormOpen}}">
      <text>
    Selected dates:
    </text>
      <text wx:for="{{selectedDays}}" wx:for-index='key' wx:for-item="item" wx:key="{{key}}" id="{{key}}"> 
        <text  wx:if="{{item != null}}">{{item}}
        </text>
      </text>
      <!-- <view class="section section_gap">
        <view class="section__title">是否與他人共享</view>
        <switch name="switch" />
      </view> -->
      <view class="section section_gap">
        <view class="section__title">Importance</view>
        <slider name="slider" show-value block-size="20"></slider>
      </view>
      <view class="section section_gap">
        <view class="section__title">Importance</view>
        <radio-group name="radio-group">
          <label>低
            <radio value="1" />
          </label>
          <label>中
            <radio value="2" />
          </label>
          <label>高
            <radio value="3" />
          </label>
        </radio-group>
      </view>
      <view class="section">
        <view class="section__title">Task name</view>
        <input name="input" placeholder="please input here" />
      </view>
      <view class="section">
        <view class="section__title">Task content</view>
        <textarea placeholder="form 中的 textarea" name="textarea" />
      </view>
      <view class="btn-area">
        <button formType="submit">Submit</button>
        <button formType="reset">Reset</button>
        <button type="warn" bindtap="closeAddingTask">Cancel adding task</button>
      </view>
    </form>
  </view>
</view>